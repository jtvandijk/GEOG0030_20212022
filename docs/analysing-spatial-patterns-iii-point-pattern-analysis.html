<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Analysing Spatial Patterns III: Point Pattern Analysis | GEOG0030: Geocomputation</title>
  <meta name="description" content="8 Analysing Spatial Patterns III: Point Pattern Analysis | GEOG0030: Geocomputation handbook." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Analysing Spatial Patterns III: Point Pattern Analysis | GEOG0030: Geocomputation" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jtvandijk.github.io/GEOG0030/" />
  
  <meta property="og:description" content="8 Analysing Spatial Patterns III: Point Pattern Analysis | GEOG0030: Geocomputation handbook." />
  <meta name="github-repo" content="jtvandijk/GEOG0030" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Analysing Spatial Patterns III: Point Pattern Analysis | GEOG0030: Geocomputation" />
  
  <meta name="twitter:description" content="8 Analysing Spatial Patterns III: Point Pattern Analysis | GEOG0030: Geocomputation handbook." />
  

<meta name="author" content="Justin van Dijk" />


<meta name="date" content="2021-12-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="analysing-spatial-patterns-ii-spatial-autocorrelation.html"/>
<link rel="next" href="rasters-zonal-statistics-and-interpolation.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo">
<a href="https://www.ucl.ac.uk/module-catalogue/modules/geocomputation-GEOG0030"><img src="images/general/ucl_logo.png">
</a></li>

<li class="divider"></li>
<li class="part"><span><b>Module overview</b></span></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Module Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#welcome"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#moodle"><i class="fa fa-check"></i>Moodle</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#module-overview"><i class="fa fa-check"></i>Module overview</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#troubleshooting"><i class="fa fa-check"></i>Troubleshooting</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="part"><span><b>Foundational Concepts</b></span></li>
<li class="chapter" data-level="1" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html"><i class="fa fa-check"></i><b>1</b> Geocomputation: An Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#recording-w01"><i class="fa fa-check"></i><b>1.1</b> Lecture recording</a></li>
<li class="chapter" data-level="1.2" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#reading-w01"><i class="fa fa-check"></i><b>1.2</b> Reading list</a></li>
<li class="chapter" data-level="1.3" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#getting-started"><i class="fa fa-check"></i><b>1.3</b> Getting started</a></li>
<li class="chapter" data-level="1.4" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#software"><i class="fa fa-check"></i><b>1.4</b> Software</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#qgis-installation"><i class="fa fa-check"></i><b>1.4.1</b> QGIS Installation</a></li>
<li class="chapter" data-level="1.4.2" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#r-and-rstudio-installation"><i class="fa fa-check"></i><b>1.4.2</b> R and RStudio Installation</a></li>
<li class="chapter" data-level="1.4.3" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#ucl"><i class="fa fa-check"></i><b>1.4.3</b> UCL Desktop and RStudio Server</a></li>
<li class="chapter" data-level="1.4.4" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#a-note-on-arcgis"><i class="fa fa-check"></i><b>1.4.4</b> A note on ArcGIS</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#file-management"><i class="fa fa-check"></i><b>1.5</b> File management</a></li>
<li class="chapter" data-level="1.6" data-path="geocomputation-an-introduction.html"><a href="geocomputation-an-introduction.html#byl-w01"><i class="fa fa-check"></i><b>1.6</b> Before you leave</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html"><i class="fa fa-check"></i><b>2</b> GIScience and GIS software</a>
<ul>
<li class="chapter" data-level="2.1" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#recording-w02"><i class="fa fa-check"></i><b>2.1</b> Lecture recording</a></li>
<li class="chapter" data-level="2.2" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#reading-w02"><i class="fa fa-check"></i><b>2.2</b> Reading list</a></li>
<li class="chapter" data-level="2.3" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#simple-digitisation-of-spatial-features"><i class="fa fa-check"></i><b>2.3</b> Simple digitisation of spatial features</a></li>
<li class="chapter" data-level="2.4" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#population-change-in-london"><i class="fa fa-check"></i><b>2.4</b> Population change in London</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#setting-the-scene"><i class="fa fa-check"></i><b>2.4.1</b> Setting the scene</a></li>
<li class="chapter" data-level="2.4.2" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#w02-finding"><i class="fa fa-check"></i><b>2.4.2</b> Finding our data sets</a></li>
<li class="chapter" data-level="2.4.3" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#w02-downloading"><i class="fa fa-check"></i><b>2.4.3</b> Downloading and processing</a></li>
<li class="chapter" data-level="2.4.4" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#using-qgis-to-map-our-population-data"><i class="fa fa-check"></i><b>2.4.4</b> Using QGIS to map our population data</a></li>
<li class="chapter" data-level="2.4.5" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#exporting-map-for-visual-analysis"><i class="fa fa-check"></i><b>2.4.5</b> Exporting map for visual analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#assignment-w02"><i class="fa fa-check"></i><b>2.5</b> Assignment</a></li>
<li class="chapter" data-level="2.6" data-path="giscience-and-gis-software.html"><a href="giscience-and-gis-software.html#byl-w02"><i class="fa fa-check"></i><b>2.6</b> Before you leave</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html"><i class="fa fa-check"></i><b>3</b> Cartography and Visualisation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html#recording-w03"><i class="fa fa-check"></i><b>3.1</b> Lecture recording</a></li>
<li class="chapter" data-level="3.2" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html#reading-w03"><i class="fa fa-check"></i><b>3.2</b> Reading list</a></li>
<li class="chapter" data-level="3.3" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html#crime-in-london"><i class="fa fa-check"></i><b>3.3</b> Crime in London</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html#w03-finding"><i class="fa fa-check"></i><b>3.3.1</b> Finding our data sets</a></li>
<li class="chapter" data-level="3.3.2" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html#w03-downloading"><i class="fa fa-check"></i><b>3.3.2</b> Downloading and processing</a></li>
<li class="chapter" data-level="3.3.3" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html#using-qgis-to-map-our-crime-data"><i class="fa fa-check"></i><b>3.3.3</b> Using QGIS to map our crime data</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html#assignment-w03"><i class="fa fa-check"></i><b>3.4</b> Assignment</a></li>
<li class="chapter" data-level="3.5" data-path="cartography-and-visualisation.html"><a href="cartography-and-visualisation.html#byl-w03"><i class="fa fa-check"></i><b>3.5</b> Before you leave</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html"><i class="fa fa-check"></i><b>4</b> Programming for Data Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#recording-w04"><i class="fa fa-check"></i><b>4.1</b> Lecture recording</a></li>
<li class="chapter" data-level="4.2" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#reading-w04"><i class="fa fa-check"></i><b>4.2</b> Reading list</a></li>
<li class="chapter" data-level="4.3" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#programming"><i class="fa fa-check"></i><b>4.3</b> Programming</a></li>
<li class="chapter" data-level="4.4" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#programming-in-r"><i class="fa fa-check"></i><b>4.4</b> Programming in R</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#the-rstudio-interface"><i class="fa fa-check"></i><b>4.4.1</b> The RStudio interface</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#rstudio-console"><i class="fa fa-check"></i><b>4.5</b> RStudio console</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#command-input"><i class="fa fa-check"></i><b>4.5.1</b> Command Input</a></li>
<li class="chapter" data-level="4.5.2" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#storing-variables"><i class="fa fa-check"></i><b>4.5.2</b> Storing variables</a></li>
<li class="chapter" data-level="4.5.3" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#accessing-and-returning-variables"><i class="fa fa-check"></i><b>4.5.3</b> Accessing and returning variables</a></li>
<li class="chapter" data-level="4.5.4" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#variables-of-different-data-types"><i class="fa fa-check"></i><b>4.5.4</b> Variables of different data types</a></li>
<li class="chapter" data-level="4.5.5" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#calling-functions-on-our-variables"><i class="fa fa-check"></i><b>4.5.5</b> Calling functions on our variables</a></li>
<li class="chapter" data-level="4.5.6" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#returning-functions"><i class="fa fa-check"></i><b>4.5.6</b> Returning functions</a></li>
<li class="chapter" data-level="4.5.7" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#examining-our-variables-using-functions"><i class="fa fa-check"></i><b>4.5.7</b> Examining our variables using functions</a></li>
<li class="chapter" data-level="4.5.8" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#creating-a-two-element-object"><i class="fa fa-check"></i><b>4.5.8</b> Creating a two-element object</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#simple-analysis"><i class="fa fa-check"></i><b>4.6</b> Simple analysis</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#housekeeping"><i class="fa fa-check"></i><b>4.6.1</b> Housekeeping</a></li>
<li class="chapter" data-level="4.6.2" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#atomic-vectors"><i class="fa fa-check"></i><b>4.6.2</b> Atomic vectors</a></li>
<li class="chapter" data-level="4.6.3" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#matrices"><i class="fa fa-check"></i><b>4.6.3</b> Matrices</a></li>
<li class="chapter" data-level="4.6.4" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#dataframes"><i class="fa fa-check"></i><b>4.6.4</b> Dataframes</a></li>
<li class="chapter" data-level="4.6.5" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#column-names"><i class="fa fa-check"></i><b>4.6.5</b> Column names</a></li>
<li class="chapter" data-level="4.6.6" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#adding-columns"><i class="fa fa-check"></i><b>4.6.6</b> Adding columns</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#crime-analysis-i"><i class="fa fa-check"></i><b>4.7</b> Crime analysis I</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#starting-a-project"><i class="fa fa-check"></i><b>4.7.1</b> Starting a project</a></li>
<li class="chapter" data-level="4.7.2" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#setting-up-a-script"><i class="fa fa-check"></i><b>4.7.2</b> Setting up a script</a></li>
<li class="chapter" data-level="4.7.3" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#running-a-script"><i class="fa fa-check"></i><b>4.7.3</b> Running a script</a></li>
<li class="chapter" data-level="4.7.4" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#crime-data-2"><i class="fa fa-check"></i><b>4.7.4</b> Crime data</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#assignment-w04"><i class="fa fa-check"></i><b>4.8</b> Assignment</a></li>
<li class="chapter" data-level="4.9" data-path="programming-for-data-analysis.html"><a href="programming-for-data-analysis.html#byl-w04"><i class="fa fa-check"></i><b>4.9</b> Before you leave</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html"><i class="fa fa-check"></i><b>5</b> Programming for Spatial Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#recording-w05"><i class="fa fa-check"></i><b>5.1</b> Lecture recording</a></li>
<li class="chapter" data-level="5.2" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#reading-w05"><i class="fa fa-check"></i><b>5.2</b> Reading list</a></li>
<li class="chapter" data-level="5.3" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#crime-analysis-ii"><i class="fa fa-check"></i><b>5.3</b> Crime analysis II</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#data-preparation"><i class="fa fa-check"></i><b>5.3.1</b> Data preparation</a></li>
<li class="chapter" data-level="5.3.2" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#spatial-analysis-set-up"><i class="fa fa-check"></i><b>5.3.2</b> Spatial analysis set up</a></li>
<li class="chapter" data-level="5.3.3" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#interacting-with-spatial-data"><i class="fa fa-check"></i><b>5.3.3</b> Interacting with spatial data</a></li>
<li class="chapter" data-level="5.3.4" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#getting-our-crime-data-in-shape"><i class="fa fa-check"></i><b>5.3.4</b> Getting our crime data in shape</a></li>
<li class="chapter" data-level="5.3.5" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#data-wrangling"><i class="fa fa-check"></i><b>5.3.5</b> Data wrangling</a></li>
<li class="chapter" data-level="5.3.6" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#improving-your-workflow"><i class="fa fa-check"></i><b>5.3.6</b> Improving your workflow</a></li>
<li class="chapter" data-level="5.3.7" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#aggregate-crime-by-ward"><i class="fa fa-check"></i><b>5.3.7</b> Aggregate crime by ward</a></li>
<li class="chapter" data-level="5.3.8" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#joining-crime-data-to-wards"><i class="fa fa-check"></i><b>5.3.8</b> Joining crime data to wards</a></li>
<li class="chapter" data-level="5.3.9" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#mapping-crime-data"><i class="fa fa-check"></i><b>5.3.9</b> Mapping crime data</a></li>
<li class="chapter" data-level="5.3.10" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#styling-crime-data"><i class="fa fa-check"></i><b>5.3.10</b> Styling crime data</a></li>
<li class="chapter" data-level="5.3.11" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#exporting-our-crime-data"><i class="fa fa-check"></i><b>5.3.11</b> Exporting our crime data</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#assignment-w05"><i class="fa fa-check"></i><b>5.4</b> Assignment</a></li>
<li class="chapter" data-level="5.5" data-path="programming-for-spatial-analysis.html"><a href="programming-for-spatial-analysis.html#byl-w05"><i class="fa fa-check"></i><b>5.5</b> Before you leave</a></li>
</ul></li>
<li class="part"><span><b>Core Spatial Analysis</b></span></li>
<li class="chapter" data-level="6" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><i class="fa fa-check"></i><b>6</b> Analysing Spatial Patterns I: Geometric Operations and Spatial Queries</a>
<ul>
<li class="chapter" data-level="6.1" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#recording-w06"><i class="fa fa-check"></i><b>6.1</b> Lecture recording</a></li>
<li class="chapter" data-level="6.2" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#reading-w06"><i class="fa fa-check"></i><b>6.2</b> Reading list</a></li>
<li class="chapter" data-level="6.3" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#bike-theft-w06"><i class="fa fa-check"></i><b>6.3</b> Bike theft in London</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#housekeeping-w06"><i class="fa fa-check"></i><b>6.3.1</b> Housekeeping</a></li>
<li class="chapter" data-level="6.3.2" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#loading-data-w06"><i class="fa fa-check"></i><b>6.3.2</b> Loading data</a></li>
<li class="chapter" data-level="6.3.3" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#data-preparation-w06"><i class="fa fa-check"></i><b>6.3.3</b> Data preparation</a></li>
<li class="chapter" data-level="6.3.4" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#spatial-operations-i"><i class="fa fa-check"></i><b>6.3.4</b> Spatial operations I</a></li>
<li class="chapter" data-level="6.3.5" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#spatial-operations-ii"><i class="fa fa-check"></i><b>6.3.5</b> Spatial operations II</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#assignment-w06"><i class="fa fa-check"></i><b>6.4</b> Assignment</a></li>
<li class="chapter" data-level="6.5" data-path="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html"><a href="analysing-spatial-patterns-i-geometric-operations-and-spatial-queries.html#byl-w06"><i class="fa fa-check"></i><b>6.5</b> Before you leave</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><i class="fa fa-check"></i><b>7</b> Analysing Spatial Patterns II: Spatial Autocorrelation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#recording-w07"><i class="fa fa-check"></i><b>7.1</b> Lecture recording</a></li>
<li class="chapter" data-level="7.2" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#reading-w07"><i class="fa fa-check"></i><b>7.2</b> Reading list</a></li>
<li class="chapter" data-level="7.3" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#childhood-obesity"><i class="fa fa-check"></i><b>7.3</b> Childhood obesity</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#housekeeping-w07"><i class="fa fa-check"></i><b>7.3.1</b> Housekeeping</a></li>
<li class="chapter" data-level="7.3.2" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#loading-data-w07"><i class="fa fa-check"></i><b>7.3.2</b> Loading data</a></li>
<li class="chapter" data-level="7.3.3" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#data-preparation-w07"><i class="fa fa-check"></i><b>7.3.3</b> Data preparation</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#statistical-distributions"><i class="fa fa-check"></i><b>7.4</b> Statistical distributions</a></li>
<li class="chapter" data-level="7.5" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#assignment-1-w07"><i class="fa fa-check"></i><b>7.5</b> Assignment 1</a></li>
<li class="chapter" data-level="7.6" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#spatial-distributions"><i class="fa fa-check"></i><b>7.6</b> Spatial distributions</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#spatial-lag"><i class="fa fa-check"></i><b>7.6.1</b> Spatial lag</a></li>
<li class="chapter" data-level="7.6.2" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#defining-neighbours"><i class="fa fa-check"></i><b>7.6.2</b> Defining neighbours</a></li>
<li class="chapter" data-level="7.6.3" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#spatial-weights-matrix"><i class="fa fa-check"></i><b>7.6.3</b> Spatial weights matrix</a></li>
<li class="chapter" data-level="7.6.4" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#global-morans-i"><i class="fa fa-check"></i><b>7.6.4</b> Global Moran’s I</a></li>
<li class="chapter" data-level="7.6.5" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#geary-cs"><i class="fa fa-check"></i><b>7.6.5</b> Geary C’s</a></li>
<li class="chapter" data-level="7.6.6" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#getis-ord-general-g"><i class="fa fa-check"></i><b>7.6.6</b> Getis-Ord General G</a></li>
<li class="chapter" data-level="7.6.7" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#local-morans-i"><i class="fa fa-check"></i><b>7.6.7</b> Local Moran’s I</a></li>
<li class="chapter" data-level="7.6.8" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#getis-gi"><i class="fa fa-check"></i><b>7.6.8</b> Getis-Gi*</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#assignment-2-w07"><i class="fa fa-check"></i><b>7.7</b> Assignment 2</a></li>
<li class="chapter" data-level="7.8" data-path="analysing-spatial-patterns-ii-spatial-autocorrelation.html"><a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html#byl-w07"><i class="fa fa-check"></i><b>7.8</b> Before you leave</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html"><i class="fa fa-check"></i><b>8</b> Analysing Spatial Patterns III: Point Pattern Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#recording-w08"><i class="fa fa-check"></i><b>8.1</b> Lecture recording</a></li>
<li class="chapter" data-level="8.2" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#reading-w08"><i class="fa fa-check"></i><b>8.2</b> Reading list</a></li>
<li class="chapter" data-level="8.3" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#bike-theft-w08"><i class="fa fa-check"></i><b>8.3</b> Bike theft in London</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#housekeeping-w08"><i class="fa fa-check"></i><b>8.3.1</b> Housekeeping</a></li>
<li class="chapter" data-level="8.3.2" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#loading-data-w08"><i class="fa fa-check"></i><b>8.3.2</b> Loading data</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#point-pattern-analysis"><i class="fa fa-check"></i><b>8.4</b> Point pattern analysis</a></li>
<li class="chapter" data-level="8.5" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#density-based-techniques"><i class="fa fa-check"></i><b>8.5</b> Density-based techniques</a>
<ul>
<li class="chapter" data-level="" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#quadrat-analysis"><i class="fa fa-check"></i>Quadrat analysis</a></li>
<li class="chapter" data-level="8.5.1" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#kernel-density-estimation"><i class="fa fa-check"></i><b>8.5.1</b> Kernel Density Estimation</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#assignment-w08-1"><i class="fa fa-check"></i><b>8.6</b> Assignment 1</a></li>
<li class="chapter" data-level="8.7" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#distance-based-methods"><i class="fa fa-check"></i><b>8.7</b> Distance-Based Methods</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#average-nearest-neighbour"><i class="fa fa-check"></i><b>8.7.1</b> Average Nearest Neighbour</a></li>
<li class="chapter" data-level="8.7.2" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#ripleys-k-function"><i class="fa fa-check"></i><b>8.7.2</b> Ripley’s K function</a></li>
<li class="chapter" data-level="8.7.3" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#dbscan"><i class="fa fa-check"></i><b>8.7.3</b> DBSCAN</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="analysing-spatial-patterns-iii-point-pattern-analysis.html"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#byl-w08"><i class="fa fa-check"></i><b>8.8</b> Before you leave</a></li>
</ul></li>
<li class="part"><span><b>Advanced Spatial Analysis</b></span></li>
<li class="chapter" data-level="9" data-path="rasters-zonal-statistics-and-interpolation.html"><a href="rasters-zonal-statistics-and-interpolation.html"><i class="fa fa-check"></i><b>9</b> Rasters, Zonal Statistics and Interpolation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="rasters-zonal-statistics-and-interpolation.html"><a href="rasters-zonal-statistics-and-interpolation.html#recording-w09"><i class="fa fa-check"></i><b>9.1</b> Lecture recording</a></li>
<li class="chapter" data-level="9.2" data-path="rasters-zonal-statistics-and-interpolation.html"><a href="rasters-zonal-statistics-and-interpolation.html#reading-w09"><i class="fa fa-check"></i><b>9.2</b> Reading list</a></li>
<li class="chapter" data-level="9.3" data-path="rasters-zonal-statistics-and-interpolation.html"><a href="rasters-zonal-statistics-and-interpolation.html#assignment-w09"><i class="fa fa-check"></i><b>9.3</b> Assignment</a></li>
<li class="chapter" data-level="9.4" data-path="rasters-zonal-statistics-and-interpolation.html"><a href="rasters-zonal-statistics-and-interpolation.html#byl-w09"><i class="fa fa-check"></i><b>9.4</b> Before you leave</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="network-analysis.html"><a href="network-analysis.html"><i class="fa fa-check"></i><b>10</b> Network Analysis</a>
<ul>
<li class="chapter" data-level="10.1" data-path="network-analysis.html"><a href="network-analysis.html#recording-w10"><i class="fa fa-check"></i><b>10.1</b> Lecture recording</a></li>
<li class="chapter" data-level="10.2" data-path="network-analysis.html"><a href="network-analysis.html#reading-w10"><i class="fa fa-check"></i><b>10.2</b> Reading list</a></li>
<li class="chapter" data-level="10.3" data-path="network-analysis.html"><a href="network-analysis.html#assignment-w10"><i class="fa fa-check"></i><b>10.3</b> Assignment</a></li>
<li class="chapter" data-level="10.4" data-path="network-analysis.html"><a href="network-analysis.html#byl-w10"><i class="fa fa-check"></i><b>10.4</b> Before you leave</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEOG0030: Geocomputation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysing-spatial-patterns-iii-point-pattern-analysis" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Analysing Spatial Patterns III: Point Pattern Analysis</h1>
<p>This week, we will be looking at how we can use Point Pattern Analysis (PPA) to detect and delineate clusters within point data. Within point pattern analysis, we look to detect clusters or patterns across a set of points, including measuring density, dispersion and homogeneity in our point structures. There are several approaches to calculating and detecting these clusters, which are explained in our main lecture. We then deploy several PPA techniques, including Kernel Density Estimation, on our bike theft data to continue our investigation from the week before last.</p>
<div id="recording-w08" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Lecture recording</h2>
<ul>
<li>Lecture W8</li>
</ul>
</div>
<div id="reading-w08" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Reading list</h2>
<ul>
<li>Reading #1</li>
<li>Reading #2</li>
</ul>
</div>
<div id="bike-theft-w08" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Bike theft in London</h2>
<p>This week, we continue to investigate bike theft in London in 2019 - as we look to confirm our very simple hypothesis: that bike theft primarily occurs near tube and train stations. This week, instead of looking at the distance of individual bike thefts from train stations, we will look to analyse the distribution of clusters in relation to the stations. We will first look at this visually and then look to compare these clusters to the location of train and tube stations quantitatively using geometric operations.</p>
<p>To complete this analysis, we will again use the following data sets:
- Bike theft in London for 2019 from <a href="https://tfl.gov.uk/">data.police.uk</a>
- Train and Tube Stations from <a href="https://data.police.uk/">Transport for London</a></p>
<div id="housekeeping-w08" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Housekeeping</h3>
<p>Let’s get ourselves ready to start our lecture and practical content by first downloading the relevant data and loading this within our script.</p>
<p>Open a new script within your GEOG0030 project and save this script as <code>wk8-bike-theft-PPA.r</code>. At the top of your script, add the following metadata (substitute accordingly):</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysing bike theft and its relation to stations using point pattern analysis</span></span>
<span id="cb250-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Data: January 2021</span></span>
<span id="cb250-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Author: Justin</span></span></code></pre></div>
<p>All of the geometric operations and spatial queries we will use are contained within the <code>sf</code> library. For our Point Pattern Analysis, we will be using the <code>spatstat</code> library (“spatial statistics”). The <code>spatstat</code> library contains the different Point Pattern Analysis techniques we will want to use in this practical. We will also need the <code>raster</code> library, which provides classes and functions to manipulate geographic (spatial) data in ‘raster’ format. We will use this package briefly today, but look into it in more detail next week. Lastly, you will also need to install <code>dbscan</code>.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># libraries</span></span>
<span id="cb251-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb251-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb251-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb251-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb251-6"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span>
<span id="cb251-7"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb251-8"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb251-9"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb251-10"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span></code></pre></div>
</div>
<div id="loading-data-w08" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Loading data</h3>
<p>This week, we will continue to use our data from Week 06. This includes:</p>
<ul>
<li>London Ward boundaries for 2018</li>
<li>Crime in London for 2019 from <a href="https://data.police.uk/">data.police.uk</a></li>
<li>Train and Tube Stations from <a href="https://tfl.gov.uk/">Transport for London</a></li>
</ul>
<p>You should load these data sets as new variables in this week’s script. You should have the original data files for both the London Wards and 2019 crime already in your <strong>raw</strong> data folder.</p>
<div class="note">
<p><strong>Note</strong> <br />
If you did not export your OpenStreetMap train and tube stations from our practical in week W06, you will need to re-run parts of your code to download and then export the OpenStreetMap data. If this is the case, open your <code>wk6-bike-theft-analysis.r</code> and make sure you create a shapefile of the train and tube stations.</p>
</div>
<p>Let’s go ahead and load all of our data at once - we did our due diligence in Week 06 and know what our data looks like and what CRS they are in, so we can go ahead and use pipes to make loading our data more efficient:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in our 2018 London Ward boundaries</span></span>
<span id="cb252-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-2" aria-hidden="true" tabindex="-1"></a>london_ward_shp <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;data/raw/boundaries/2018/London_Ward.shp&quot;</span>)</span>
<span id="cb252-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in our OSM tube and train stations data</span></span>
<span id="cb252-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-5" aria-hidden="true" tabindex="-1"></a>london_stations_osm <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;data/raw/transport/osm_stations.shp&quot;</span>)</span>
<span id="cb252-6"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-7"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="co"># read in our crime data csv from our raw data folder</span></span>
<span id="cb252-8"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-8" aria-hidden="true" tabindex="-1"></a>bike_theft_2019 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/raw/crime/crime_all_2019_london.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb252-9"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clean names with janitor</span></span>
<span id="cb252-10"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb252-11"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter according to crime type and ensure we have no NAs in our data set</span></span>
<span id="cb252-12"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(crime_type <span class="sc">==</span> <span class="st">&quot;Bicycle theft&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(longitude) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(latitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb252-13"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select just the longitude and latitude columns</span></span>
<span id="cb252-14"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(longitude, latitude) <span class="sc">%&gt;%</span></span>
<span id="cb252-15"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform into a point spatial dataframe</span></span>
<span id="cb252-16"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note providing the columns as the coordinates to use</span></span>
<span id="cb252-17"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plus the CRS, which as our columns are long/lat is WGS84/4236</span></span>
<span id="cb252-18"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), <span class="at">crs =</span> <span class="dv">4236</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb252-19"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert into BNG</span></span>
<span id="cb252-20"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">27700</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb252-21"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clip to London</span></span>
<span id="cb252-22"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb252-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(london_ward_shp)</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
<p>Let’s create a quick map of our data to check it loaded correctly:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot our London Wards first</span></span>
<span id="cb254-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(london_ward_shp) <span class="sc">+</span> <span class="fu">tm_fill</span>() <span class="sc">+</span> </span>
<span id="cb254-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add bike crime as blue</span></span>
<span id="cb254-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(bike_theft_2019) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb254-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add our stations as red</span></span>
<span id="cb254-6"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(london_stations) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> </span>
<span id="cb254-7"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add a north arrow</span></span>
<span id="cb254-8"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">&quot;arrow&quot;</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb254-9"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add a scale bar</span></span>
<span id="cb254-10"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb254-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>), <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>))</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-map-all-data-1.png" width="672" /></p>
<p>Great - that looks familiar! This means we can move forward with our data analysis and theoretical content for this week.</p>
</div>
</div>
<div id="point-pattern-analysis" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Point pattern analysis</h2>
<p>Point pattern analysis (PPA) studies the spatial distribution of points. PPA uses the <strong>density</strong>, <strong>dispersion</strong> and <strong>homogeneity</strong> in our point data sets to assess, quantify and characterise its distribution. Over the last fifty years, various methods and measurements have been developed to analyze, model, visualise, and interpret these properties of point patterns (<a href="https://gistbok.ucgis.org/bok-topics/point-pattern-analysis">Qiang et al, 2020</a>).</p>
<p>There are three main categories of PPA techniques:</p>
<ul>
<li><strong>Descriptive statistics</strong>: The use of descriptive statistics will provide a summary of the basic characteristics of a point pattern, such as its central tendency and dispersion. Descriptive statistics provide a simple way of visualising a data set as a whole, from plotting the median or mean centre, or, often preferably, a standard deviational ellipse for those data sets that display a directional pattern.</li>
<li><strong>Density-based methods</strong>: Density-based methods focus on the <em>first-order</em> properties of a data set, i.e. the variation in the individual locations of the points in the data set across the area of interest, and will characterise our data set’s distribution accordingly in terms of density.</li>
<li><strong>Distanced-based methods</strong>: Distanced-based methods focus on the <em>second-order</em> properties of a data set, i.e. the interactions between points within our data and whether they appear to have influence on one another and form clusters, and will characterise our data set’s distribution accordingly in terms of dispersion.</li>
</ul>
<p>The main library to use when it comes to point pattern analysis in R is the <code>spatstat</code> library, developed by Baddeley, Rubak and Turner since <strong>2005</strong>. As their documentation states, <code>spatstat</code> “is a package for the statistical analysis of spatial data. Its main focus is the analysis of spatial patterns of points in two-dimensional space”. According to it’s “Get Started with <code>spatstat</code>” documentation, "<code>spatstat</code> supports a very wide range of popular techniques for statistical analysis for spatial point patterns, including:</p>
<ul>
<li>Kernel estimation of density/intensity</li>
<li>Quadrat counting and clustering indices</li>
<li>Detection of clustering using Ripley’s K-function</li>
<li>Model-fitting</li>
<li>Monte Carlo tests</li>
</ul>
<p>as well as some advanced statistical techniques" (<a href="https://cran.r-project.org/web/packages/spatstat/vignettes/getstart.pdf">Baddeley et al, 2020</a>). We will only cover a brief amount of the functionality the package offers - it has almost 1,800 pages of documentation and over 1000 commands, so it would be near impossible to cover everything even if we had a full module dedicated just to PPA. Instead, we will focus on some key PPA techniques:</p>
<ul>
<li>Quadrat Analysis</li>
<li>Kernel Density Estimation</li>
<li>Nearest Neighbour</li>
<li>Ripley’s K function</li>
</ul>
<p>But before we get started with our analysis, you need to know one critical piece of information in order to use <code>spatstat</code>: we need our data to be in the format of a <code>ppp</code> object. There are some spatial packages in R that require us to convert our data from an <code>sf</code> simple features object (e.g. for point data, a SpatialPoints object) into a different spatial object class - and <code>spatstat</code> is one of them.</p>
<div class="note">
<p><strong>Note</strong> <br />
The <code>ppp</code> format is specific to <code>spatstat</code>, but you may find it used in other spatial libraries. An object of the class <code>ppp</code> represents a two-dimensional point data set within a pre-defined area, known as the <strong>window of observation</strong>, a class in its own right, known as <code>owin</code> in <code>spatstat</code>. We can either directly create a <code>ppp</code> object from a list of coordinates (as long as they are supplied with a window) <strong>or</strong> convert from another data type (using the <code>as.ppp()</code> function). However, as <code>spatstat</code> predates <code>sf</code>, this conversion function does not yet work with <code>sf</code> data objects. Instead, therefore, we have to create a workaround workflow that enables us to extract the coordinates from our <code>bike_theft_2019</code> spatial dataframe for use within the <code>ppp</code> function.</p>
</div>
<p>To turn our <code>bike_theft_2019</code> spatial dataframe into a <code>ppp</code> object, we need to extract the geometry of our bike theft points, store this geometry as two separate columns within a matrix, and provide these columns, alongside an observation window equal to our <code>london_ward_shp</code> spatial dataframe, to create a PPP object:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a window of observation</span></span>
<span id="cb255-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb255-2" aria-hidden="true" tabindex="-1"></a>window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(london_ward_shp<span class="sc">$</span>geometry)</span>
<span id="cb255-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb255-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extract coordinates from our bike theft data set as a matrix</span></span>
<span id="cb255-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb255-5" aria-hidden="true" tabindex="-1"></a>bike_theft_xy <span class="ot">&lt;-</span> bike_theft_2019 <span class="sc">%&gt;%</span> <span class="fu">st_coordinates</span>()</span>
<span id="cb255-6"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb255-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-7"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb255-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a ppp object</span></span>
<span id="cb255-8"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb255-8" aria-hidden="true" tabindex="-1"></a>bike_theft_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x=</span>bike_theft_xy[,<span class="dv">1</span>], <span class="at">y=</span> bike_theft_xy[,<span class="dv">2</span>], <span class="at">window=</span>window)</span></code></pre></div>
<pre><code>## Warning: data contain duplicated points</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot our ppp object</span></span>
<span id="cb257-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike_theft_ppp)</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-spatstat-ppp-object-1.png" width="672" /></p>
<p>Our plot shows us our <code>bike_theft_ppp</code> object, which includes both the coordinate points of our bike theft data and our London window. You should also see your <code>bike_theft_ppp</code> object variable appear in your Environment window - as well as see a message stating that our data <em>contain duplicated points</em>.</p>
<p>Let’s see if this is true - we can first use a logical statement from the <strong>R base library</strong> to check if our <code>bike_theft_ppp</code> object contains duplicated points and then count the total number of duplicates exist using the <code>multiplicity()</code> function (which “counts the number of duplicates for each point in a spatial point pattern”) from the <code>spatstat</code> library.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates using </span></span>
<span id="cb258-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anyDuplicated</span>(bike_theft_ppp)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count the sum of the number of duplicated points</span></span>
<span id="cb260-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">multiplicity</span>(bike_theft_ppp) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 12352</code></pre>
<p>One of the <strong>key assumptions</strong> underlying many analytical methods is that <strong>all events are unique</strong>. In fact, some statistical procedures actually may return very wrong results if duplicate points are found within the data. In terms of our bike theft data, it is unsurprising that it contains duplicates. The Police service use <a href="https://data.police.uk/about/#anonymisation">snapping points</a>, to which crimes are snapped to in order to preserve the anonymity and privacy of those involved. This is an issue in spatial point pattern analysis as we need our “events”, i.e. each record of a crime and its respective location, to <strong>be unique</strong> in order for our analysis to be accurate.</p>
<p>To account for these issues within our data set (and other data sets that contain duplicates), we have three options:</p>
<ol style="list-style-type: decimal">
<li><p>We can remove the duplicates and pretend they simply are not there. However, this is feasible only when your research problem allows for this, i.e. the number of points at each location is not as important as the locations themselves, and therefore you are happy to ‘ignore’ some of the data.</p></li>
<li><p>Create and assign a weighting schema to our points, where each point will have an attribute that details the number of events that occur in that location - and utilise this weight within our PPA techniques. Weights however can only be used with certain PPA techniques (e.g. Kernel Density Estimation).</p></li>
<li><p>Force all points to be unique by utilising a function that offsets our points randomly from their current location. If the <strong>precise</strong> location is not important for your analysis - or, for example, you are dealing with data that in our case is already slightly offset, we can introduce a “jitter” to our data set that slightly adjusts all coordinates so that the event locations do not exactly coincide anymore. This way, our duplicates will no longer have the same precise location. This approach however introduces a certain level of uncertainty into the precise location of any analysis derived from our data sets.</p></li>
</ol>
<p>Each approach will have a specific compromise, which you will have to decide upon depending on the type of analysis you are completing. In our case, we will choose the jitter approach to keep all of our bike theft events. We know that already the location of our bike thefts are not precise locations of the original theft, therefore adding additional offset will not detract from our analysis.</p>
<p>Let’s shift all our coordinates slighlty to ‘remove’ our duplicates and essentially ‘move’ all points into unique locations. We will use the <code>rjitter</code> function from the <code>spatstat</code> library, which applies an independent random displacement to each point in a point pattern:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add an offset to our points using the rjitter function</span></span>
<span id="cb262-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb262-2" aria-hidden="true" tabindex="-1"></a>bike_theft_ppp_jitter <span class="ot">&lt;-</span> <span class="fu">rjitter</span>(bike_theft_ppp, <span class="at">retry=</span><span class="cn">TRUE</span>, <span class="at">nsim=</span><span class="dv">1</span>, <span class="at">drop=</span><span class="cn">TRUE</span>)</span>
<span id="cb262-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb262-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="co"># count the number of duplicated points of the new jitter data set</span></span>
<span id="cb262-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anyDuplicated</span>(bike_theft_ppp_jitter)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the resulting ppp object</span></span>
<span id="cb264-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike_theft_ppp_jitter)</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-jitter-jitter-jitter-1.png" width="672" /></p>
<p>Great, we now have our bike theft data in a format ready to be analysed with our different PPA techniques using the <code>spatstat</code> library!</p>
<div class="note">
<p><strong>Note</strong> <br />
One additional thing to note about the <code>ppp</code> data object is that a <code>ppp</code> object does not necessarily have to have any attributes (our fields) associated with the events each point our point data represents. If your data does have attributes (such as calculating a weight as outlined above for dealing with duplications), these attributes are referred to as <strong>marks</strong> within the <code>spatstat</code> environment. Be aware that some functions do require these marks to be present - and you will find this out only from the <code>spatstat</code> documentation. We will not use any functions/techniques today that require marks.</p>
</div>
</div>
<div id="density-based-techniques" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Density-based techniques</h2>
<p>Density-based techniques are used to characterise the pattern of a point data set utilising its general distribution. A bit like our spatial autocorrelation techniques, we can calculate densities at both the <strong>global</strong> and <strong>local</strong> scale. However, as you will see, for PPA, global density really does not tell us much more about the distribution of our data - in terms of areas of high and low densities, for example. This is where local density techniques such as <strong>Quadrat Analysis</strong> and <strong>Kernel Density Estimation</strong> can help us visualise these differences in density in our data’s distribution.</p>
<div id="quadrat-analysis" class="section level3 unnumbered">
<h3>Quadrat analysis</h3>
<p>We can create a simple understanding of our data’s distribution by first understanding its <strong>global density</strong> - this is simply the ratio of the observed number of points, <span class="math inline">\(n\)</span> , to the study region’s surface area, <span class="math inline">\(a\)</span>:</p>
<center>
<span class="math inline">\(\widehat{\lambda} =\frac{n}{a}\)</span>
</center>
<p><br></p>
<p>Calculate the global density of our bike theft point data relative to London:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the global density of our bike points</span></span>
<span id="cb265-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb265-2" aria-hidden="true" tabindex="-1"></a>global_density <span class="ot">&lt;-</span> <span class="fu">length</span>(bike_theft_2019<span class="sc">$</span>NAME)<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">st_area</span>(london_ward_shp))</span>
<span id="cb265-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb265-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb265-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb265-5" aria-hidden="true" tabindex="-1"></a>global_density</span></code></pre></div>
<pre><code>## 1.174831e-05 [1/m^2]</code></pre>
<p>We can see that we have a global density of 0.00001174 bike thefts per m^2 in London. This simple density analysis could be supported with further descriptive statistics, however, we still would know little about the local density of our points.</p>
<p>The most basic approach to understanding a point pattern’s local density is to simply measure the density at different locations within the study area. This approach helps us assess if the density is constant across the study area. The most simplest approach to this measurement is through <strong>Quadrat Analysis</strong>, where the study area is divided into sub-regions, aka <em>quadrats</em>. The point density is then computed for each quadrat, by dividing the number of points in each quadrat by the quadrat’s area.</p>
<p>Quadrats can take on many different shapes (and utlise different approaches to creating these shapes). The most basic approach is using squares (or rather, a grid). Furthermore, the choice of quadrat numbers and quadrat shape can influence the measure of local density and therefore must be chosen with care. We will start with a simple quadrat count by dividing the observation window into 15 x 15 sections and then counting the number of bicycle thefts within each quadrant using the <code>quadratcount()</code> function within R.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratcount in a 15 x 15 grid across the observational window</span></span>
<span id="cb267-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb267-2" aria-hidden="true" tabindex="-1"></a>biketheft_quadrat <span class="ot">&lt;-</span> <span class="fu">quadratcount</span>(bike_theft_ppp_jitter,<span class="at">nx=</span><span class="dv">10</span>,<span class="at">ny=</span><span class="dv">10</span>)</span>
<span id="cb267-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb267-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect</span></span>
<span id="cb267-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb267-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(biketheft_quadrat)</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-quadrat-count-1.png" width="672" /></p>
<p>Our resulting quadrat count shows total counts of bike theft - we can see quite quickly that the quadrats in central London are likely to have a higher local density as their count is much higher than those on the outskirts of London. If we divided our count by the area covered by each quadrat, we would also be able to calculate a precise local density. We will not do this for now, as realistically, it is not often that you would want to use quadrat analysis for actual PPA. The reason why we look at this technique is that it provides us with an easy way to think about how to compare our data distribution and how this relates to the <strong>Poisson distribution of Complete Spatial Randomness (CSR)</strong>.</p>
<p>When looking at the distribution of our points and the respective patterns they show, the key question we often want to answer as geographers and spatially-enabled thinkers is: are our points clustered, randomly distributed (i.e. display complete spatial randomness), uniform or dispersed? Whilst we can visually assess this distribution, to be able to statistically quantify our data’s distribution, we can compare its distribution to that of the <strong>Poisson distribution</strong>. The Poisson distribution describes the probability or rate of an event happening over a fixed interval of time or space.</p>
<p>The Poisson Distribution applies when:</p>
<ul>
<li>The events are discrete and can be counted in integers</li>
<li>Events are independent of each other</li>
<li>The average number of events over space or time is known</li>
</ul>
<p>Point data that contains a random distribution of points is said to have a <strong>Poisson distribution</strong>. The Poisson distribution is very useful in Point Pattern Analysis as it allows us to compare a random expected model to our observations. Essentially, if our data does not fit the Poisson model, then we can infer that something interesting might be going on and our events might not actually be independent of each other. Instead, they might be clustered or dispersed and there is likely to be underlying processes influencing these patterns. The most basic test of CSR with the Poisson distribution in PPA can be completed with our <strong>Quadrat Analysis</strong> results.</p>
<p>We compare our quadrat results with a Poisson distribution for the same quadrats and determine whether the pattern is generated in a random manner; i.e. whether the distribution of points in our study area differs from complete spatial randomness (CSR) or whether there are some clusters present. To enable this, we can run a <strong>Chi-Squared Test</strong> of our data against a theoretical randomly generated point pattern data set with the same number of points and window, with the null hypotheses that our point data have been generated under complete spatial randomness. Our chi-squared test will tell us whether our data is distributed under the null hypothesis - and determine whether there is a statistically significant difference between the expected distribution (i.e. CSR) and the observed distribution (our bike theft point data):</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chi-square between observed point pattern of our data and Poisson sampled points</span></span>
<span id="cb268-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quadrat.test</span>(bike_theft_ppp_jitter,<span class="at">nx=</span><span class="dv">10</span>,<span class="at">ny=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Warning: Some expected counts are small; chi^2 approximation may be inaccurate</code></pre>
<pre><code>## 
##  Chi-squared test of CSR using quadrat counts
## 
## data:  bike_theft_ppp_jitter
## X2 = 55332, df = 80, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided
## 
## Quadrats: 81 tiles (irregular windows)</code></pre>
<p>Our <span class="math inline">\(p\)</span> value is well below 0.05 (or 0.01 for that matter), which means there is a statistically significant difference between the expected distribution (i.e. CSR) and the observed distribution (our bike theft point data). We can therefore reject the null hypothesis that our point data have been generated under complete spatial randomness and confirm that our point pattern was not generated in a random matter.However, our completing both a quadrat analysis and the resulting Chi-Squared test is not exactly the most efficient way of looking to understand the relative local densities of our data set - nor can we compare these results to the location of our train and tube stations to look into our original hypothesis that bike theft primarily occurs near tube and train stations.</p>
</div>
<div id="kernel-density-estimation" class="section level3" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Kernel Density Estimation</h3>
<p>We now have an understanding of whether our data is randomly distributed or not - and our quadrats give us a very coarse understanding of where there may be clusters within our data. But instead of looking at the distribution of our bike theft with the boundaries of our quadrats (or any other tessellation we could pick), we can also analyse our points using a <strong>Kernel Density Estimation (KDE)</strong>. KDE is a statistical technique to generate a smooth continuous distribution between data points that represent the density of the underlying pattern.</p>
<p>Within spatial analysis, a KDE will produce a surface (raster) that details the estimated distribution of our event point data over space. Each cell within our raster contains a value that is this estimated density at that location; when visualised in its entirety as the whole raster, we can quickly identify areas of high and low density, i.e. where are clusters are located in our data set. To create this surface, a KDE computes a localised density for small subsets of our study area - but unlike quadrat analysis, these subsets overlap one another to create a <em>moving</em> sub-region window, defined by a <strong>kernel</strong>. A kernel defines the shape and size of the window and can also weight the points, using a defined kernel function. The simplest kernel function is a basic kernel where each point in the kernel window is assigned equal weight. The kernel density approach generates a grid of density values whose cell size is smaller than that of the kernel window. Each cell is assigned the density value computed for the kernel window centered on that cell. The resulting surface is created from these individually, locally calculated density values.</p>
<p>Producing a KDE in R is very straight-forward in <code>spatstat</code>, using your ppp object and the <code>density.ppp()</code> function. However, you will need to consider both the <strong>bandwidth</strong> or diameter of your Kernel (<code>sigma</code>) and whether you want to apply a weighting to your points using a function. First, let’s go ahead and create a simple KDE of bike theft with our bandwidth set to 100m:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimation of our bike theft ppp object</span></span>
<span id="cb271-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma=</span><span class="dv">100</span>))</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-kde-ppp-1.png" width="672" /></p>
<p>We can see from just our KDE that there are visible clusters present within our bike theft data, particularly in and around central London. We can even see our south-west cluster that we saw in our proportional symbols map last week. We can go ahead and vary our bandwidth to to see how that affects the density estimate:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kernel density estimation of our bike theft ppp object with 500m bandwith</span></span>
<span id="cb272-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma=</span><span class="dv">500</span>))</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-kde-ppp-2-1.png" width="672" /></p>
<p>Our clusters now appear brighter and larger than our KDE with a 100m bandwidth - this is because changing the bandwidth enables your KDE to take into account more points within its calculation, resulting in a smoother surface. However, there are issues with oversmoothing your data - as you can see above, our clusters are not as well defined and therefore we may attribute high levels of bike theft to areas where there actually is not that much. Smaller bandwidths will lead to a more irregular shaped surface, where we have more precision in our defined clusters - but, once again, there are issues of undersmoothing. In our case, as we know bike theft is not exactly a phenomena that obeys strict square boundaries, we may run into similar issues of boundary effects that we see in areal unit aggregation, and end up not extending our clusters far enough to cover our “hotspot” areas.</p>
<p>Whilst there are automated functions (e.g. based on maximum-likelihood estimations) that can help you with selecting an appropriate bandwidth, in the end you will have to make a decision on what is most appropriate for your data set. Thinking through the phenomenon that you are analysing will help. Although bandwidth typically has a more pronounced effect upon the density estimation than the type of kernel used, kernel types can affect the result too.</p>
<p>When we use a different kernel type, we are looking to weight the points within our kernel differently:</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-24"></span>
<img src="images/w08/kerneltypes.png" alt="Kernel Types and Their Distributions." width="650pt" />
<p class="caption">
Figure 8.1: Kernel Types and Their Distributions.
</p>
</div>
<p>Each function will result in a slightly different estimation.“The normal distribution weighs all points in the study area, though near points are weighted more highly than distant points. The other four techniques use a circumscribed circle around the grid cell. The uniform distribution weighs all points within the circle equally. The quartic function weighs near points more than far points, but the fall off is gradual. The triangular function weighs near points more than far points within the circle, but the fall off is more rapid. Finally, the negative exponential weighs near points much more highly than far points within the circle and the decay is very rapid.” (<a href="https://nij.ojp.gov/sites/g/files/xyckuh171/files/media/document/CrimeStat%2520IV%2520Chapter%252010.pdf">Levine, 2013</a>).</p>
<p>Deciding which function is most suitable for your analysis will all depend on what you are trying to capture. We can compare and see the impact of different functions on our current data set looking at the default kernel in <code>density.ppp()</code>, which gaussian, alongside the epanechnikov, quartic or disc kernels. Note, the sigma in these KDEs is set to 400m:</p>
<p><img src="GEOG0030_files/figure-html/08-kde-ppp-3-1-1.png" width="672" /></p>
<p><img src="GEOG0030_files/figure-html/08-kde-ppp-3-2-1.png" width="672" /></p>
<p><img src="GEOG0030_files/figure-html/08-kde-ppp-3-3-1.png" width="672" /></p>
<p><img src="GEOG0030_files/figure-html/08-kde-ppp-3-4-1.png" width="672" /></p>
<p>To change the kernel within your KDE, you simply need to add the <code>kernel</code> parameter and set it to one of the kernels available, denoted as a string, e.g. “epanechnikov”, “quartic”, “disc”. Ultimately, bandwidth will have a more marked effect upon the density estimation than kernel type. For now, however, no matter which kernel or which bandwidth (within reason, of course) we use, we can be quite confident in stating that bike theft in London in 2019 is not a spatially random process and we can clearly see the areas where bicycle theft is most concentrated.</p>
<p>How can we use this new data in our original analysis that looks to find out whether bike theft primarily occurs near tube and train stations? The main use of a KDE is primarily for visual analysis of our point data distribution. However, our current plotting approach is quite limited - if you had not noticed, we have primarily been using the <code>base</code> R plotting techniques to display the results of our <code>density.ppp()</code> function. It would therefore be difficult to create any maps that allow visual comparison to our train stations - nor could we really complete any further analysis on our KDE data set. This is because, at the moment, our KDE raster is stored as a <code>spatstat</code> object - and is not, currently, a standalone raster data set. As a result, we cannot use our KDE with other visualisation libraries such as <code>tmap</code> - or in the future <code>ggplot2</code>.</p>
<p>To enable this use, we need to first export our KDE <code>spatstat</code> object into a standalone raster that can be used with these libraries. We therefore need to look to the <code>raster</code> library that is capable of doing just that. Until now, with our spatial data, we have primarily used <strong>vector</strong> data that the <code>sf</code> library can read, load and manage - however the <code>sf</code> library does not contain the right functions to enable the same reading, loading and management of <strong>raster</strong> data. As a result, it is not a suitable spatial library for dealing with raster data. Instead, we need to use the <code>raster</code> library, which is the default spatial library for dealing with raster data (i.e. just as we use <code>sf</code> for vector, we use <code>raster</code> for raster).</p>
<p>To convert <code>spatstat</code> KDE object into a raster, we only need one very simple function from the raster library: <code>raster()</code>. To return a raster from our <code>density.ppp()</code> function, we simply need to pipe its output into the <code>raster</code> function:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a raster directly from the output of our KDE</span></span>
<span id="cb273-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb273-2" aria-hidden="true" tabindex="-1"></a>kde_400g_raster <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(bike_theft_ppp_jitter, <span class="at">sigma =</span> <span class="dv">400</span>, <span class="at">edge=</span>T) <span class="sc">%&gt;%</span> <span class="fu">raster</span>()</span>
<span id="cb273-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb273-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb273-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the resulting raster</span></span>
<span id="cb273-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_400g_raster)</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-kde-raster-1.png" width="672" /></p>
<p>We now have a standalone raster we can use with a) any (analysis-oriented) functions in the <code>raster()</code> library (more on this next week) and b) our visualisation libraries, including <code>tmap</code>. Before we go ahead, one issue we will face - although it is not clear in the plot above - is that our resulting raster does not have a Coordinate Reference System. A bit like using the <code>st_crs()</code> function in <code>sf</code>, we can use the <code>crs()</code> function within the <code>raster</code> library to check our <code>kde_400g_raster</code> CRS:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the CRS of the kde_400g_raster</span></span>
<span id="cb274-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(kde_400g_raster)</span></code></pre></div>
<pre><code>## CRS arguments: NA</code></pre>
<p>You should see an <strong>NA</strong> appear within our CRS arguments - the <code>kde_400g_raster</code> does not have a CRS, so we will need to set the CRS:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the CRS of the kde_400g_raster to BNG</span></span>
<span id="cb276-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(kde_400g_raster) <span class="ot">&lt;-</span> <span class="st">&quot;+init=EPSG:27700&quot;</span></span></code></pre></div>
<pre><code>## Warning in showSRID(uprojargs, format = &quot;PROJ&quot;, multiline = &quot;NO&quot;, prefer_proj =
## prefer_proj): Discarded datum OSGB_1936 in Proj4 definition</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the CRS of the kde_400g_raster</span></span>
<span id="cb278-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(kde_400g_raster)</span></code></pre></div>
<pre><code>## CRS arguments:
##  +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000
## +y_0=-100000 +ellps=airy +units=m +no_defs</code></pre>
<p>Now we have our raster ready to map - let’s map it using <code>tmap</code>. We use the same “Grammar of Graphics” approach that we’ve used with our vector data and will first provide <code>tmap</code> with our <code>kde_400g_raster</code> as a <code>tm_shape()</code>. We then add the <code>tm_raster()</code> function, with the required and optional parameters we want to include:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># map our kde_400g_raster using tmap</span></span>
<span id="cb280-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(kde_400g_raster) <span class="sc">+</span> </span>
<span id="cb280-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="st">&quot;layer&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;viridis&quot;</span>)</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-kde-raster-map-1.png" width="672" /></p>
<p>With our <code>kde_400g_raster</code> using <code>tmap</code>, we can go ahead and customise our map as we would do with our vector mapping - for example, changing the legend tile, adding a title, north arrow etc.</p>
</div>
</div>
<div id="assignment-w08-1" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Assignment 1</h2>
<p>We are now one step closer to visually investigating our original hypothesis - that bike theft primarily occurs near tube and train stations. To help with our analysis, we could go ahead and change the <code>tmap_mode</code> to the view mode and use the basemap to visually investigate the distribution of bike theft and its relation to train stations. Alternatively, we could make a static map that overlays our <code>london_stations_osm</code> spatial dataframe as part of our map and compare their location against our visible clusters, that we could use for visual analysis and confirmation of our hypothesis.</p>
<p>For this week’s assignment, you need to produce a finished KDE map for bike theft in London that also shows the <strong>location of train stations</strong> relative to our KDE clusters. You can adjust the bandwidth and kernel settings if you like, but mainly you need to create a final map that contains this additional data layer as well our expected mapping conventions, plus a title and a renamed legend title. Once your map is done: do you think our hypothesis is confirmed? How confident are you in this assessment?</p>
</div>
<div id="distance-based-methods" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Distance-Based Methods</h2>
<p>We have spent a good amount of time looking at using density-based methods to a) quantify whether our point data is randomly distributed or not and b) visualise and identify high and low areas of density, showing if our data is clustered and where. Overall, within PPA, (kernel) density estimation is certainly a prominent technique, but we also have <strong>distance-based</strong> methods that allow us to quantify the 2nd order properties of our data, i.e. the influence the location of these points have on one another.</p>
<p>Distance-based measures analyze the spatial distribution of points using distances between point pairs, with the majority using Euclidean distance, to determine quantitatively whether our data is, again, randomly distributed or shows sign of clustering or dispersion. These methods are a more rigorous alternative to using the Quadrat Analysis approach, and enables us to assess clustering within our point data at both a global and local scale.</p>
<div id="average-nearest-neighbour" class="section level3" number="8.7.1">
<h3><span class="header-section-number">8.7.1</span> Average Nearest Neighbour</h3>
<p>Average Nearest Neighbour (ANN) is the average distance between all points within a data set and their individual nearest point (known as Nearest-Neighbour Distance (NND)). ANN is used as a global indicator to measure the overall pattern of a point set. The ANN of a given point collection can be compared with the expected ANN from points following complete spatial randomness (CSR) to test whether our point data is clustered or dispersed (<a href="https://gistbok.ucgis.org/bok-topics/point-pattern-analysis">Yuan <em>et al.</em> 2020)</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-25"></span>
<img src="images/w08/ann_ppa.png" alt="Relations between different point patterns and mean nearest neighbor distance (NND). Source: [Yuan *et al.* 2020](https://gistbok.ucgis.org/bok-topics/point-pattern-analysis)." width="400" />
<p class="caption">
Figure 8.2: Relations between different point patterns and mean nearest neighbor distance (NND). Source: <a href="https://gistbok.ucgis.org/bok-topics/point-pattern-analysis">Yuan <em>et al.</em> 2020</a>.
</p>
</div>
<p>The approach is similar to that of the Quadrat Analysis simulation we saw above, but by using distance rather than density grouped to arbitrary quadrats, ANN is likely to be a more robust quantification of our point distribution. We can calculate the ANN for our data set by using the <code>nndist()</code> function from the <code>spatstat</code> library:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the average distance to nearest neighbour</span></span>
<span id="cb281-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">nndist</span>(bike_theft_ppp_jitter, <span class="at">k=</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 61.3923</code></pre>
<p>We can see that the average nearest neighbour for all points is 61.3 metres. To understand whether our data set is clustered or dispersed, we now need to run a Monte Carlo simulation of running the ANN test for multiple (think hundreds) of Poisson distributions of our bike thefts within our London ward in order to generate a graph as above. Then, similar to our Global Moran’s I calculation, we would compare our mean to that of all of the means generated to determine whether our data set is clustered or dispersed.</p>
<p>The code and computing requirements to complete this analysis is quite complex, therefore, we look instead to different approach, which is to plot the ANN values for different order neighbours (i.e. first closest point, second closest point etc), to get an insight into the spatial ordering of all our points relative to one another. For point patterns that are highly clustered, we would expect that the average distances between points to be very short. However, this is based on the important assumption that the point pattern is stationary throughout the study area. Further to this, the size and shape of the study area also have a very strong effect on this metric.</p>
<p>Calculate the average nearest neighbour to the <span class="math inline">\(k\)</span> nearest neighbours for our bike theft data:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the ANN for up to 100 neighbours</span></span>
<span id="cb283-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb283-2" aria-hidden="true" tabindex="-1"></a>bike_theft_ann <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">nndist</span>(bike_theft_ppp_jitter, <span class="at">k=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>),<span class="dv">2</span>,<span class="at">FUN=</span>mean)</span>
<span id="cb283-3"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb283-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-4"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the results of k ANN</span></span>
<span id="cb283-5"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb283-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bike_theft_ann <span class="sc">~</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>))</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-average-nearest-neighbours-1.png" width="672" /></p>
<p>In our case, the plot does not reveal anything interesting in particular except that higher order points seem to be slightly closer than lower order points. Overall, the ANN is a good approach to conduct statistical tests on large data sets (if we were to run the Monte Carlo simulation explore above), but visually it does not tell us a huge amount about our data set!</p>
</div>
<div id="ripleys-k-function" class="section level3" number="8.7.2">
<h3><span class="header-section-number">8.7.2</span> Ripley’s K function</h3>
<p>One way of getting around the limitations of both the ANN and Quadrat Analysis is to use <strong>Ripley’s K function</strong>. Ripley’s K function looks at the distance between a point and ‘all distances’ to other points and automatically compare this to a Poisson-distribution point pattern (without the need to add in Monte Carlo simulation code as above). Ripley’s K function essentially summarises the distance between points for all distances using radial distance bands. The calculation is relatively straightforward:</p>
<ol style="list-style-type: decimal">
<li>For point <strong>event A</strong>, count the number of points inside a buffer (radius) of a certain size. Then count the number of points inside a slightly larger buffer (radius).</li>
<li>Repeat this for every point event in the data set.</li>
<li>Compute the average number of points in each buffer (radius) and divide this to the overall point density.</li>
<li>Repeat this using points drawn from a Poisson random model for the same set of buffers.</li>
<li>Compare the observed distribution with the distribution with the Poisson distribution.</li>
</ol>
<p>We can conduct a Ripley’s K test on our data very simply with the <code>spatstat</code> package using the <code>Kest()</code> function.</p>
<div class="note">
<p><strong>Note</strong> <br />
Be careful with running Ripley’s K on large datasets as the function is essentially a series of nested loops, meaning that calculation time will increase exponentially with an increasing number of points.</p>
</div>
<p>Run a Ripley’s K function on our bike theft data using the <code>Kest()</code> function:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate Ripley&#39;s K for our bicycle theft locations, maximum radius of 1 kilometre</span></span>
<span id="cb284-2"><a href="analysing-spatial-patterns-iii-point-pattern-analysis.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Kest</span>(bike_theft_ppp_jitter,<span class="at">correction=</span><span class="st">&#39;border&#39;</span>,<span class="at">rmax=</span><span class="dv">5000</span>))</span></code></pre></div>
<p><img src="GEOG0030_files/figure-html/08-ripley-and-his-k-1.png" width="672" /></p>
<p>The <em>Kpois(r)</em> line shows the theoretical value of K for each distance radius (r) under a Poisson assumption of Complete Spatial Randomness. When our observed/calculated K values are greater than the expected K, this indicates clustering of points at a given distance band. In our data set, we can see our observed distribution exceeds the Poisson distribution across our distance bands - therefore our data is more clustered than what would be expected in a random distribution across our various local scales.</p>
<p>There are several limitations to Ripley’s K - in the same fashion as the Average Nearest Neighbour Analysis- it assumes a stationary underlying point process. From our previous analysis and visualisation of our bike theft data, we know that this is unlikely to be the case, with the prevalence of bike theft influenced by a multitude of factors that they themselves vary over space.</p>
</div>
<div id="dbscan" class="section level3" number="8.7.3">
<h3><span class="header-section-number">8.7.3</span> DBSCAN</h3>
</div>
</div>
<div id="byl-w08" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> Before you leave</h2>
<p>Primarily, as geographers and spatially-enabled thinkers, we are keen to understand our point data’s distribution and understand whether are our points clustered, randomly distributed (i.e. display complete spatial randomness), uniform or dispersed. We have looked at various techniques that enable us to statistically and visually assess our data’s distribution and understand whether our data is randomly distributed or not.</p>
<p>Primarily, our main focus is using Kernel Density Estimation as a technique for the visual display and analysis of our data and its respective areas of high and low density. However, we can also use DBSCAN to create precise cluster outlines that can be also used for visual analysis - but also can be further used for quantitative analysis, via geometric operations. And that is <a href="https://www.youtube.com/watch?v=-zxtbwGogyY">us done for this week</a>.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="analysing-spatial-patterns-ii-spatial-autocorrelation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rasters-zonal-statistics-and-interpolation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jtvandijk/GEOG0030/edit/master/08-point-pattern.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/jtvandijk/GEOG0030/raw/master/08-point-pattern.Rmd"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
